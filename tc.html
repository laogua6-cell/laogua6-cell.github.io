<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>è€ç“œçš„çˆ±å¿ƒæ¶ˆæ¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }
        
        /* å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 450px;
            width: 80%;
            text-align: center;
            border: 2px solid #ff6b6b;
            animation: modalAppear 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, #ff6b6b, #ff8e8e, #ff6b6b);
        }
        
        @keyframes modalAppear {
            0% { transform: scale(0.7) rotate(-5deg); opacity: 0; }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }
        
        .modal-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 20px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            position: relative;
            display: inline-block;
        }
        
        .modal-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 10%;
            width: 80%;
            height: 3px;
            background: linear-gradient(to right, transparent, #ff6b6b, transparent);
        }
        
        .modal-message {
            font-size: 20px;
            color: #333;
            margin-bottom: 30px;
            line-height: 1.6;
            padding: 0 10px;
        }
        
        .confirm-btn {
            background: linear-gradient(to right, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 14px 35px;
            border-radius: 50px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .confirm-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .confirm-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5);
        }
        
        .confirm-btn:hover::before {
            left: 100%;
        }
        
        .confirm-btn:active {
            transform: translateY(1px);
        }
        
        .heart-icon {
            font-size: 40px;
            color: #ff6b6b;
            margin-bottom: 15px;
            animation: heartbeat 1.5s infinite;
        }
        
        @keyframes heartbeat {
            0% { transform: scale(1); }
            5% { transform: scale(1.1); }
            10% { transform: scale(1); }
            15% { transform: scale(1.15); }
            20% { transform: scale(1); }
            100% { transform: scale(1); }
        }
        
        /* åŠ¨ç”»å®¹å™¨ */
        #container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            display: none;
            overflow: hidden;
        }
        
        /* çˆ±å¿ƒåŠ¨ç”»æ ·å¼ */
        .message-window {
            position: absolute;
            width: 60px;
            height: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-size: 12px;
            text-align: center;
            z-index: 10;
            opacity: 0;
            transform: scale(0.8);
            animation: popup 1.5s forwards;
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s, opacity 0.5s;
            padding: 6px;
        }
        
        .message-window:hover {
            transform: scale(1.1);
            z-index: 100;
        }
        
        @keyframes popup {
            0% { opacity: 0; transform: scale(0.8); }
            70% { transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .instruction {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            color: #fff;
            font-size: 14px;
            z-index: 20;
            background-color: rgba(0,0,0,0.5);
            padding: 8px;
            border-radius: 5px;
            margin: 0 15px;
            display: none;
        }
        
        .exit-hint {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            color: #fff;
            z-index: 20;
            display: none;
        }
        
        .progress-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 40px);
            max-width: 200px;
            height: 16px;
            background-color: rgba(255,255,255,0.2);
            border-radius: 8px;
            z-index: 20;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffa36c);
            width: 0%;
            transition: width 0.5s;
            border-radius: 8px;
        }
        
        .progress-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            color: #fff;
        }
        
        .music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background-color: rgba(0,0,0,0.5);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 30;
            display: none;
        }
    </style>
</head>
<body>
    <!-- å¼¹çª—ç»“æ„ -->
    <div id="modal" class="modal-overlay">
        <div class="modal-content">
            <div class="heart-icon">â¤ï¸</div>
            <div class="modal-title">è¿™æ˜¯æˆ‘æƒ³ç»™ä½ è¯´çš„è¯</div>
            <div class="modal-message">è¿™æ˜¯æˆ‘çœŸå¿ƒè¦è¯´çš„</div>
            <button id="confirmBtn" class="confirm-btn">ç¡®è®¤</button>
        </div>
    </div>
    
    <!-- åŠ¨ç”»å®¹å™¨ -->
    <div id="container"></div>
    <div class="progress-container" style="display: none;">
        <div class="progress-bar"></div>
        <div class="progress-text">æ­£åœ¨é“ºæ»¡: 0%</div>
    </div>
    <div class="instruction" style="display: none;">åŒå‡»å±å¹•é€€å‡ºåŠ¨ç”»</div>
    <div class="exit-hint"  style="display: none;">åŒå‡»é€€å‡º</div>
    
    <!-- éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
    <div class="music-control" id="musicControl" style="display: none;">â™ª</div>

    <script>
        // å¼¹çª—æ§åˆ¶é€»è¾‘
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('modal');
            const confirmBtn = document.getElementById('confirmBtn');
            const container = document.getElementById('container');
            const musicControl = document.getElementById('musicControl');
            
            // åˆ›å»ºéŸ³é¢‘å…ƒç´ 
            const audio = new Audio();
            // æ›¿æ¢ä¸ºæ‚¨å–œæ¬¢çš„éŸ³ä¹é“¾æ¥
            audio.src = 'http://music.163.com/song/media/outer/url?id=2152489678.mp3';
            audio.loop = true;
            audio.volume = 0.5;
            
            let isPlaying = false;
            
            // ç‚¹å‡»ç¡®è®¤æŒ‰é’®å…³é—­å¼¹çª—å¹¶å¼€å§‹åŠ¨ç”»å’ŒéŸ³ä¹
            confirmBtn.addEventListener('click', function() {
                modal.style.animation = 'none';
                setTimeout(() => {
                    modal.style.opacity = '0';
                    modal.style.transform = 'scale(0.8) rotate(5deg)';
                    
                    setTimeout(function() {
                        modal.style.display = 'none';
                        // æ˜¾ç¤ºåŠ¨ç”»å®¹å™¨
                        container.style.display = 'block';
                        // æ˜¾ç¤ºéŸ³ä¹æ§åˆ¶æŒ‰é’®
                        musicControl.style.display = 'flex';
                        // å¼€å§‹æ’­æ”¾éŸ³ä¹
                        audio.play().then(() => {
                            isPlaying = true;
                            musicControl.textContent = 'â™ª';
                        }).catch(error => {
                            console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', error);
                        });
                        // å¼€å§‹ä¸»åŠ¨ç”»
                        main();
                    }, 300);
                }, 10);
            });
            
            // éŸ³ä¹æ§åˆ¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            musicControl.addEventListener('click', function() {
                if (isPlaying) {
                    audio.pause();
                    musicControl.textContent = 'ğŸ”‡';
                } else {
                    audio.play();
                    musicControl.textContent = 'â™ª';
                }
                isPlaying = !isPlaying;
            });
        });
        
        // åŠ¨ç”»é€»è¾‘
        const tips = [
            'å¤šå–æ°´å“¦~', 'å¥½å¥½çˆ±è‡ªå·±', 'å¥½å¥½åƒé¥­', 'ä¿æŒå¥½å¿ƒæƒ…', 
            'æˆ‘æƒ³ä½ äº†', 'é¡ºé¡ºåˆ©åˆ©', 'åˆ«ç†¬å¤œ', 'å¤©å†·äº†å¤šç©¿è¡£æœ',
            'åŠ æ²¹å‘€', 'å¼€å¿ƒæ¯ä¸€å¤©', 'è®°å¾—å¾®ç¬‘', 'ç…§é¡¾å¥½è‡ªå·±',
            'æ³¨æ„ä¼‘æ¯', 'ä¸€åˆ‡éƒ½ä¼šå¥½', 'å¹³å®‰å–œä¹', 'å¤©å¤©å¼€å¿ƒ'
        ];
        
        const colors = [
            '#ffcccc', '#cce7ff', '#d6eaff', '#fff9cc', '#ffccf5', 
            '#b3e0ff', '#FFC0CB', '#ADD8E6', '#90EE90', '#FFFACD', 
            '#FF69B4', '#87CEEB', '#E0FFFF', '#FFE4E1', '#E6E6FA'
        ];
       
        let heartWindows = [];
        let noteWindows = [];
        let animationActive = true;
        let lastTapTime = 0;
        const container = document.getElementById('container');
        
        // ç”Ÿæˆçˆ±å¿ƒç‚¹é€»è¾‘
        function generateHeartPoints(n, width, height) {
            const points = [];
            const baseSize = Math.min(width, height) * 0.35;
            const centerX = (width / 2) - 42;
            const centerY = height / 2;
            
            for (let i = 0; i < n; i++) {
                const t = (i / n) * Math.PI * 2;
                const x = 16 * Math.pow(Math.sin(t), 3);
                const y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
                
                const scale = baseSize / 15;
                const pointX = centerX + x * scale;
                const pointY = centerY + y * scale;
                
                const maxX = width - 90;
                const constrainedX = Math.max(0, Math.min(pointX, maxX));
                const constrainedY = Math.max(0, Math.min(pointY, height - 30));
                
                points.push([constrainedX, constrainedY]);
            }
            return points;
        }
        
        // åˆ›å»ºçª—å£é€»è¾‘
        function createWindow(x, y, text = null, isHeart = true) {
            const windowDiv = document.createElement('div');
            windowDiv.className = 'message-window';
            windowDiv.style.left = `${x}px`;
            windowDiv.style.top = `${y}px`;
            windowDiv.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            windowDiv.textContent = text || tips[Math.floor(Math.random() * tips.length)];
            
            container.appendChild(windowDiv);
            
            if (isHeart) {
                heartWindows.push(windowDiv);
            } else {
                noteWindows.push(windowDiv);
            }
            
            return windowDiv;
        }
        
        // æ¸…é™¤çˆ±å¿ƒçª—å£é€»è¾‘
        function clearHeartWindows() {
            return new Promise(resolve => {
                let removed = 0;
                const total = heartWindows.length;
                
                if (total === 0) {
                    resolve();
                    return;
                }
                
                heartWindows.forEach(window => {
                    window.style.opacity = '0';
                    window.style.transform = 'scale(0.5)';
                    setTimeout(() => {
                        if (window.parentNode) {
                            window.parentNode.removeChild(window);
                        }
                        removed++;
                        if (removed === total) {
                            heartWindows = [];
                            resolve();
                        }
                    }, 500);
                });
            });
        }
        
        // å‡æ…¢å…³é—­æ ‡ç­¾åŠ¨ç”»
        function clearNoteWindows() {
            return new Promise(resolve => {
                const total = noteWindows.length;
                if (total === 0) {
                    resolve();
                    return;
                }
                
                let removed = 0;
                noteWindows.forEach((window, index) => {
                    const delay = (index / total) * 2000;
                    
                    setTimeout(() => {
                        window.style.opacity = '0';
                        window.style.transform = 'scale(0.5)';
                        setTimeout(() => {
                            if (window.parentNode) {
                                window.parentNode.removeChild(window);
                            }
                            removed++;
                            if (removed === total) {
                                noteWindows = [];
                                resolve();
                            }
                        }, 500);
                    }, delay);
                });
            });
        }
        
        async function createNoteWindowsContinuously() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const noteCount = Math.floor(width / 90) * Math.floor(height / 30) * 5;
            
            const progressContainer = document.querySelector('.progress-container');
            const progressBar = document.querySelector('.progress-bar');
            const progressText = document.querySelector('.progress-text');
            progressContainer.style.display = 'block';
            
            for (let i = 0; i < noteCount; i++) {
                if (!animationActive) break;
                
                const x = Math.random() * (width - 0);
                const y = Math.random() * (height - 30);
                createWindow(x, y, null, false);
                
                const progress = Math.floor((i / noteCount) * 100);
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `æ­£åœ¨é“ºæ»¡: ${progress}%`;
                
                if (i % 10 === 0) {
                    await new Promise(resolve => setTimeout(resolve, 50));
                }
            }
            
            progressContainer.style.display = 'none';
        }
        
        async function main() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const heartPoints = generateHeartPoints(150, width, height);
            
            for (let i = 0; i < heartPoints.length; i++) {
                if (!animationActive) break;
                
                const [x, y] = heartPoints[i];
                const text = i === heartPoints.length - 1 ? "ä¿æŒå¥½å¿ƒæƒ…" : null;
                createWindow(x, y, text, true);
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            await new Promise(resolve => setTimeout(resolve, 3000));
            await clearHeartWindows();
            
            if (animationActive) {
                await createNoteWindowsContinuously();
                await new Promise(resolve => setTimeout(resolve, 2000));
                await clearNoteWindows();
                
                document.querySelector('.instruction').style.display = 'block';
                document.querySelector('.exit-hint').style.display = 'block';
            }
        }
        
        // åŒå‡»é€€å‡ºé€»è¾‘
        document.addEventListener('touchend', function(event) {
            const currentTime = new Date().getTime();
            const tapTime = currentTime - lastTapTime;
            
            if (tapTime < 300 && tapTime > 0) {
                event.preventDefault();
                animationActive = false;
                
                const total = heartWindows.length + noteWindows.length;
                let removed = 0;
                
                [...heartWindows, ...noteWindows].forEach((window, index) => {
                    const delay = (index / total) * 2000;
                    setTimeout(() => {
                        window.style.opacity = '0';
                        window.style.transform = 'scale(0.5)';
                        setTimeout(() => {
                            if (window.parentNode) window.parentNode.removeChild(window);
                            removed++;
                            if (removed === total) {
                                heartWindows = [];
                                noteWindows = [];
                                
                                const exitMessage = document.createElement('div');
                                exitMessage.textContent = 'å·²é€€å‡º';
                                exitMessage.style.position = 'fixed';
                                exitMessage.style.top = '50%';
                                exitMessage.style.left = '50%';
                                exitMessage.style.transform = 'translate(-50%, -50%)';
                                exitMessage.style.fontSize = '24px';
                                exitMessage.style.color = '#fff';
                                exitMessage.style.zIndex = '100';
                                exitMessage.style.backgroundColor = 'rgba(0,0,0,0.7)';
                                exitMessage.style.padding = '15px 30px';
                                exitMessage.style.borderRadius = '10px';
                                document.body.appendChild(exitMessage);
                                
                                setTimeout(() => {
                                    if (exitMessage.parentNode) exitMessage.parentNode.removeChild(exitMessage);
                                }, 2000);
                            }
                        }, 500);
                    }, delay);
                });
            }
            
            lastTapTime = currentTime;
        });
        
        // ç©ºæ ¼é”®é€€å‡º
        document.addEventListener('keydown', function(event) {
            if (event.code === 'Space') {
                const event = new Event('touchend');
                event.preventDefault = () => {};
                lastTapTime = new Date().getTime() - 200;
                document.dispatchEvent(event);
            }
        });
        
        // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç½®åŠ¨ç”»
        window.addEventListener('resize', function() {
            if (animationActive) {
                heartWindows.forEach(window => {
                    if (window.parentNode) window.parentNode.removeChild(window);
                });
                noteWindows.forEach(window => {
                    if (window.parentNode) window.parentNode.removeChild(window);
                });
                heartWindows = [];
                noteWindows = [];
                main();
            }
        });
    </script>
</body>
</html>
